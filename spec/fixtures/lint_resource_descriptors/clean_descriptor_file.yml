id: DRDs
version: v1.0.0
doc: Describes the semantics, states and state transitions associated with DRDs.
links:
  self: DRDs
  help: documentation_base/Things/DRDs
states:
  drds:
    collection:
      doc: The entry point state for interacting with DRDs.
      location: entry
      transitions:
        list:
          name: self
          next:
            - collection
        search:
          next:
            - navigation
        create:
          conditions:
            - can_create 
            - can_do_anything
          next:
            - activated
            - error   
    navigation:
      doc: Represents a filtered list of DRDs.
      transitions:
        search:
          name: self
          next:
            - navigation
        create:
          conditions:
            - can_create 
            - can_do_anything
          next:
            - activated
            - error        
  drd:
    activated:
      doc: The default state of a DRD.
      transitions:
        show:
          name: self
          next:
            - activated
        deactivate:
          conditions:
            - can_deactivate 
            - can_update 
            - can_do_anything
          next:
           - deactivated
        delete:
          conditions:
            - airlock_open 
            - can_delete 
            - can_do_anything
          next:
            - deleted
        update:
          conditions:
            - can_update 
            - can_do_anything
          next:
            - activated
        leviathan-link:
          name: leviathan
          next:
            - location: http://alps.io/schema.org/Leviathans#leviathan
    deactivated:
      doc: The DRD is shut down.
      transitions:
        show:
          name: self
          next:
            - deactivated
        activate:
          conditions:
            - can_activate 
            - can_update 
            - can_do_anything
          next:
           - activated
        update:
          conditions:
            - can_update 
            - can_do_anything
          next:
            - deactivated
        delete:
          conditions:
            - airlock_open 
            - can_delete 
            - can_do_anything
          next:
            - deleted
        leviathan-link:
          name: leviathan
          next:
            - location: http://alps.io/schema.org/Leviathans#leviathan
    deleted:
      doc: The DRD is now free-floating in space.
      location: exit
    error:
      doc: An error has occured.
      location: http://alps.io/schema.org/Error
descriptors:
  drds:
    doc: 
      html: <p>A list of DRDs.</p>
    type: semantic
    links:
      self: DRDs#drds
    descriptors:
      # Semantics
      total_count:
        doc: The total count of DRDs.
        type: semantic
        href: http://alps.io/schema.org/Integer
        sample: 1
      items:
        doc: An array of embedded DRD resources.
        type: semantic
        href: Array
        embed: multiple # Select non-ALPS values are treated as extensions in the profile.
        sample: DRDs#drds
      # Transitions
      list:
        doc: Returns a list of DRDs.
        name: self
        type: safe
        rt: drds
      search:
        doc: Returns a list of DRDs that satisfy the search term.
        type: safe
        rt: drds
        descriptors:
          search_term:
            doc: The terms to search.
            type: semantic
            href: http://alps.io/schema.org/Text
            sample: DRDs#drds
      create:
        doc: Creates a DRD.
        type: unsafe
        rt: drd
        descriptors:
          create-drd:
            doc: create a DRD
            type: semantic
            href: update-drd # Indicates that this should dereference update-drd
            links:
              self: DRDs#create-drd
              help: documentation_base/Forms/create-drd
            sample: DRDs#drds
            descriptors:
              form-name:
                name: name
                doc: The name of the DRD.
                type: semantic
                href: http://alps.io/schema.org/Text
                field_type: text
                validators:
                  - required
                  - maxlength
                sample: none
              form-leviathan_uuid:
                name: leviathan_uuid
                doc: The UUID of the creator Leviathan.
                type: semantic
                href: http://alps.io/schema.org/Text
                field_type: select
                enum:
                  href: Leviathans#list
                validators:
                  - required
                sample: none
  drd:
    doc: |
      Diagnostic Repair Drones or DRDs are small robots that move around Leviathans. They are
      built by a Leviathan as it grows.
    type: semantic
    links:
      self: DRDs#drd
    descriptors:
      # Semantics
      uuid:
        doc: The UUID of the DRD.
        type: semantic
        href: http://alps.io/schema.org/Text
        sample: 007d8e12-babd-4f2c-b01e-8b5e2f749e1b           
      name:
        doc: The name of the DRD.
        type: semantic
        href: http://alps.io/schema.org/Text
        sample: 1812
      status:
        doc: How is the DRD.
        type: semantic
        href: http://alps.io/schema.org/Text
        sample: renegade
      kind:
        doc: What kind is it.
        type: semantic
        href: http://alps.io/schema.org/Text
        sample: standard
      leviathan_uuid:
        doc: The UUID of the creator Leviathan.
        type: semantic
        href: http://alps.io/schema.org/Text
        sample: 007d8e12-babd-4f2c-b01e-8b5e2f749e1b
      built_at:
        doc: When the DRD was constructed.
        type: semantic
        href: http://alps.io/schema.org/DateTime
        sample: 2013-03-20T00:00:00+00:00
      leviathan:
        doc: The associated Leviathan resource.
        type: semantic
        href: http://alps.io/schema.org/Thing/Leviathan
        embed: single-optional
        sample: http://alps.io/schema.org/Thing/Leviathan
      # Transitions
      show:
        doc: Shows a particular DRD.
        name: self
        type: safe
        rt: drd
      activate:
        doc: Activates a DRD if it is deactivated.
        type: idempotent
        rt: drd
      deactivate:
        doc: Deactivates a DRD if it is activated.
        type: idempotent
        rt: drd
      leviathan-link:
        name: leviathan
        doc: A reference to the Leviathan the DRD works on.
        type: safe
        embed: true
        rt: http://alps.io/schema.org/Leviathan#leviathan
      update:
        doc: Updates a DRD.
        type: idempotent
        rt: drd
        descriptors:
          update-drd:
            doc: update a drd object
            type: semantic
            links:
              self: DRDs#drd/update/update-drd
              help: documentation_base/Forms/update-drd
            sample : none
            href: http://alps.io/schema.org
            descriptors:
              form-status:
                type: semantic
                doc: How is the DRD.
                href: http://alps.io/schema.org/Text
                name: status
                field_type: select
                enum:
                  - working
                  - renegade
                  - broken
                validators:
                  - required
                sample: renegade
              form-kind:
                type: semantic
                name: kind
                doc: What kind is it.
                href: http://alps.io/schema.org/Text
                field_type: select
                enum:
                  - standard
                  - sentinel
                validators:
                  - required
                sample: standard
      delete:
        rt: drd
        doc: Drops a DRD out an air-lock.
        type: idempotent    
protocols:
  http:
    list:
      uri: drds
      entry_point: drds # Indicates this endpoint is a resource entry point for the protocol.
      method: GET
      content_types:
        - application/json
        - application/hal+json
        - application/xhtml+xml
      headers:
        - Content-Type
        - ETag
      status_codes:
        200:
          description: OK
          notes:
            - We have processed your request and returned the data you asked for.
      slt: &slt1
        99th_percentile: 100ms
        std_dev: 25ms
        requests_per_second: 50 
    search: 
      uri: drds
      method: GET
      content_types:
        - application/json
        - application/hal+json
      headers:
      status_codes:
        200:
          description: OK
          notes:
            - We have processed your request and returned the data you asked for.
      slt: &slt2
        99th_percentile: 250ms
        std_dev: 50ms
        requests_per_second: 25
    create:
      uri: drds
      method: POST
      content_types:
        - application/json
        - application/hal+json
      headers:
      status_codes:
        201:
          description: OK
          notes:
            - Object created.
        403:
          description: Permission denied
          notes:
            - Object not created, insufficient permissions.
      slt: *slt2
    show:
      uri: drds/{uuid}
      method: GET
      content_types:
        - application/json
        - application/hal+json
      headers:
      status_codes:
        200:
          description: OK
          notes:
            - We have processed your request and returned the data you asked for.
      slt: *slt1
    activate:
      uri: drds/{uuid}/activate
      method: PUT
      content_types:
        - application/json
        - application/hal+json
      headers:
      status_codes:
        200:
          description: OK
          notes:
            - Object activated.
      slt: *slt1
    deactivate:
      uri: drds/{uuid}/deactivate
      method: PUT
      content_types:
        - application/json
        - application/hal+json
      headers:
      status_codes:
        200:
          description: OK
          notes:
            - Object deactivated.
      slt: *slt1
    update:
      uri: drds/{uuid}
      method: PUT
      content_types:
        - application/json
        - application/hal+json
      headers:
      status_codes:
        200:
          description: OK
          notes:
            - Object updated.
      slt: *slt2
    delete:
      uri: drds/{uuid}
      method: DELETE
      content_types:
        - application/json
        - application/hal+json
      headers:
      status_codes:
        200:
          description: OK
          notes:
            - Object deleted.
      slt: *slt1
    leviathan-link: 
      uri_source: leviathan_url
